<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Carte de service Pro</title>
  <style>
    /* Configuration papier exacte ID-1 */
    @page { 
      size: 85.60mm 53.98mm; 
      margin: 0; 
      padding: 0;
      background: #ffffff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    
    html { 
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    body { 
      width: 85.60mm;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      flex-direction: column;
      gap: 10mm;
    }

    /* Conteneur de la carte */
    .card-page {
      position: relative;
      width: 85.60mm;
      height: 53.98mm;
      border-radius: 3mm;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      background: white;
      page-break-after: always;
    }

    /* ================= RECTO DESIGN ================= */
    .front-layout {
      display: flex;
      width: 100%;
      height: 100%;
    }

    /* Barre latérale colorée (35% de la largeur) */
    .sidebar {
      width: 34%;
      background-color: var(--service-color, #2980B9);
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 4mm;
    }

    /* Motif subtil dans la barre latérale */
    .sidebar::after {
      content: '';
      position: absolute;
      bottom: -10mm;
      left: -10mm;
      width: 40mm;
      height: 40mm;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      z-index: 0;
    }

    /* Photo de profil avec bordure blanche */
    .photo-container {
      width: 22mm;
      height: 26mm;
      background: white;
      border-radius: 2mm;
      padding: 0.8mm;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      margin-bottom: 2mm;
    }

    .photo-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 1.5mm;
      display: block;
    }

    /* Logo hôpital en bas de la barre latérale */
    .sidebar-logo {
      margin-top: auto;
      margin-bottom: 3mm;
      width: 18mm;
      height: 18mm;
      background: rgba(255,255,255,0.95);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1mm;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .sidebar-logo img {
      max-width: 80%;
      max-height: 80%;
      object-fit: contain;
    }

    /* Zone principale (Information) */
    .main-content {
      flex: 1;
      padding: 3mm 3mm 2mm 4mm;
      display: flex;
      flex-direction: column;
      background-image: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    }

    .hospital-name {
      font-size: 7.5pt;
      font-weight: 700;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 3mm;
      border-bottom: 1pt solid #eee;
      padding-bottom: 1mm;
    }

    .user-name {
      font-size: 11pt;
      font-weight: 800;
      color: #2c3e50;
      text-transform: uppercase;
      line-height: 1.1;
      margin-bottom: 1mm;
    }

    .user-role {
      font-size: 8pt;
      font-weight: 600;
      color: var(--service-color, #2980B9);
      margin-bottom: 3mm;
      text-transform: uppercase;
    }

    /* Grille de détails */
    .details-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 2mm;
      row-gap: 1.2mm;
      font-size: 6.5pt;
    }

    .label {
      color: #7f8c8d;
      font-weight: 600;
      text-align: right;
    }

    .value {
      color: #34495e;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 32mm;
    }

    .footer-recto {
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }

    .signature-box {
      text-align: center;
    }
    
    .signature-img {
       height: 8mm;
       width: auto;
       opacity: 0.8;
    }

    .sign-label {
      font-size: 4.5pt;
      color: #95a5a6;
      border-top: 0.5pt solid #ddd;
      padding-top: 0.5mm;
      display: inline-block;
      width: 20mm;
    }

    /* ================= VERSO DESIGN ================= */
    .back-page {
      /* Dégradé médical profond */
      background: radial-gradient(circle at 50% 30%, #0b3d66 0%, #001f3f 100%);
      color: white;
      text-align: center;
      display: flex;
      flex-direction: column;
    }

    .back-header {
      padding-top: 5mm;
      font-size: 6pt;
      font-weight: 600;
      letter-spacing: 1px;
      opacity: 0.9;
      text-transform: uppercase;
    }

    .back-title {
      font-size: 14pt;
      font-weight: 800;
      letter-spacing: 2px;
      margin-top: 2mm;
      background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
    }

    .legal-text {
      font-size: 5pt;
      padding: 0 5mm;
      margin-top: 2mm;
      color: rgba(255,255,255,0.6);
      line-height: 1.3;
      flex: 1;
    }

    /* Conteneur ECG */
    .ecg-container {
      height: 18mm;
      width: 100%;
      background: rgba(0,0,0,0.2);
      border-top: 1px solid rgba(255,255,255,0.1);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      margin-bottom: 4mm;
    }

    /* Grille de fond style moniteur */
    .ecg-grid {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: 
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: 4mm 4mm;
    }

    .ecg-svg {
      width: 100%;
      height: 100%;
      /* Effet néon pour la ligne */
      filter: drop-shadow(0 0 2px rgba(0, 255, 200, 0.6));
    }

    .emergency-contact {
      font-size: 6pt;
      margin-bottom: 2mm;
      color: #bdc3c7;
    }
  </style>
</head>
<body>

  <div class="card-page front-layout" style="--service-color: {{ service_color|default('#2980B9') }};">
    
    <div class="sidebar">
      <div class="photo-container">
        {% if photo_url %}
          <img src="{{ photo_url }}" alt="Photo">
        {% else %}
          <img src="https://via.placeholder.com/150x200?text=PHOTO" alt="Photo">
        {% endif %}
      </div>
      
      <div class="sidebar-logo">
        {% if hopital_logo %}
          <img src="{{ hopital_logo }}" alt="Logo">
        {% else %}
           <span style="font-size:8pt; font-weight:bold; color:#333;">LOGO</span>
        {% endif %}
      </div>
    </div>

    <div class="main-content">
      <div class="hospital-name">{{ hopital_nom|default('Nom Hôpital') }}</div>
      
      <div class="user-name">{{ utilisateur.prenom }} {{ utilisateur.nom }}</div>
      <div class="user-role">{{ service_nom|default('SERVICE GÉNÉRAL') }}</div>

      <div class="details-grid">
        <div class="label">ID:</div>
        <div class="value">{{ utilisateur.id|default('000000') }}</div>
        
        <div class="label">Spécialité:</div>
        <div class="value">{{ specialite|default('Médecine') }}</div>
        
        <div class="label">Valable:</div>
        <div class="value">{{ validite }}</div>

        <div class="label">Adresse:</div>
        <div class="value">{{ adresse_physique }}</div>
      </div>

      <div class="footer-recto">
        <div></div>
        <div class="signature-box">
          <div style="font-family: 'Brush Script MT', cursive; font-size: 14pt; color: #2c3e50; margin-bottom: -1mm;">
            Validé
          </div>
          <span class="sign-label">Autorité Compétente</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card-page back-page">
    <div class="back-header">Ministère de la Santé Publique<br>Hygiène et Prévention</div>
    <div class="back-title">CARTE DE SERVICE</div>

    <div class="legal-text">
      Cette carte est la propriété de l'établissement hospitalier. Elle doit être portée de manière visible durant les heures de service. En cas de perte, veuillez contacter l'administration immédiatement.
    </div>

    <div class="ecg-container">
      <div class="ecg-grid"></div>
      <svg class="ecg-svg" viewBox="0 0 500 100" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
        <path d="
          M -10 50 
          L 20 50 
          Q 30 40 40 50 
          L 45 50 
          L 50 60 
          L 60 10 
          L 70 70 
          L 75 50 
          L 90 50 
          Q 110 30 130 50 
          L 160 50
          
          L 180 50 
          Q 190 40 200 50 
          L 205 50 
          L 210 60 
          L 220 10 
          L 230 70 
          L 235 50 
          L 250 50 
          Q 270 30 290 50 
          L 320 50
          
          L 340 50 
          Q 350 40 360 50 
          L 365 50 
          L 370 60 
          L 380 10 
          L 390 70 
          L 395 50 
          L 410 50 
          Q 430 30 450 50 
          L 510 50" 
          
          stroke="#00f2fe" 
          stroke-width="2" 
          fill="none" 
          stroke-linejoin="round" 
          stroke-linecap="round" />
      </svg>
    </div>

    <div class="emergency-contact">
      URGENCE: {{ utilisateur.telephone|default('+243 000 000 000') }}
    </div>
  </div>

</body>
</html>
